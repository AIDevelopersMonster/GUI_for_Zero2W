<!DOCTYPE html>
<html class="writer-html5" lang="ru" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Глава 5: Управление зуммером с помощью GTK+ и libgpiod &mdash; документация GUI_for_Zero2W 0.1</title>
      <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../static/css/theme.css" type="text/css" />
  
        <script data-url_root="../" id="documentation_options" src="../static/documentation_options.js"></script>
        <script src="../static/jquery.js"></script>
        <script src="../static/underscore.js"></script>
        <script src="../static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../static/doctools.js"></script>
        <script src="../static/sphinx_highlight.js"></script>
        <script src="../static/translations.js"></script>
    <script src="../static/js/theme.js"></script>
    <link rel="index" title="Алфавитный указатель" href="../genindex.html" />
    <link rel="search" title="Поиск" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            GUI_for_Zero2W
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Поиск в документации" aria-label="Поиск в документации" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Меню навигации">
              <p class="caption" role="heading"><span class="caption-text">Содержание:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../chapter01/index.html">Глава 1: Начало работы</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter02/index.html">Глава 2: Реакция на кнопку и тревожный индикатор</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter03/index.html">Глава 3: Игра „Двоичное Число“ и GPIO-индикация</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chapter04/index.html">Глава 4: RGB LED Controller (GTK + pigpio)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Меню навигации для мобильных устройств" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GUI_for_Zero2W</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Навигация по страницам">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Глава 5: Управление зуммером с помощью GTK+ и libgpiod</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../sources/chapter05/index.rst.txt" rel="nofollow"> Просмотреть исходный код страницы</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="gtk-libgpiod">
<h1>Глава 5: Управление зуммером с помощью GTK+ и libgpiod<a class="headerlink" href="#gtk-libgpiod" title="Permalink to this heading"></a></h1>
<p>В этой главе мы создадим полноценное графическое приложение для Raspberry Pi, позволяющее управлять активным зуммером и воспроизводить различные звуковые паттерны. Мы будем использовать библиотеку <cite>GTK+</cite> для создания пользовательского интерфейса и <cite>libgpiod</cite> для взаимодействия с GPIO.</p>
<p>—</p>
<section id="id1">
<h2>Обзор программы<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h2>
<p>Наша программа представляет собой простое приложение с графическим интерфейсом, которое позволяет выбрать одну из трёх предопределённых мелодий и воспроизвести её через активный зуммер, подключённый к GPIO Raspberry Pi.</p>
<p>—</p>
</section>
<section id="gui">
<h2>Как работает GUI (графический интерфейс пользователя)<a class="headerlink" href="#gui" title="Permalink to this heading"></a></h2>
<p>Интерфейс программы состоит из следующих элементов:</p>
<ul class="simple">
<li><p><strong>Заголовок окна</strong>: «Buzzer Melody».</p></li>
<li><p><strong>Радиокнопки</strong>: Три кнопки с метками «Мелодия 1», «Мелодия 2» и «Мелодия 3». Эти кнопки позволяют выбрать, какая мелодия будет проиграна. При выборе одной из них, переменная в программе <cite>selected_melody</cite> обновляется соответствующим значением.</p></li>
<li><p><strong>Кнопка «Проиграть»</strong>: При нажатии на эту кнопку, выбранная в радиокнопках мелодия воспроизводится.</p></li>
</ul>
<p>Принцип работы прост: пользователь выбирает мелодию, затем нажимает «Проиграть», и зуммер издаёт соответствующий звук.</p>
<p>—</p>
</section>
<section id="id2">
<h2>Как работает программа (логика)<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h2>
<p>Программа состоит из нескольких ключевых компонентов:</p>
<ol class="arabic simple">
<li><p><strong>Инициализация GPIO</strong>: При запуске программа открывает чип <cite>gpiochip0</cite> и запрашивает линию GPIO 17 (пин, к которому подключён зуммер) как выходной. Это делается с помощью библиотеки <cite>libgpiod</cite>, которая предоставляет современный и надёжный способ взаимодействия с GPIO в Linux.</p></li>
<li><p><strong>Управление зуммером</strong>: Функции <cite>buzzer_on()</cite> и <cite>buzzer_off()</cite> отвечают за установку высокого или низкого уровня на GPIO-пине, тем самым включая или выключая зуммер.</p></li>
<li><p><strong>Воспроизведение мелодий</strong>: Функция <cite>play_melody()</cite> содержит логику для трёх различных звуковых паттернов. В зависимости от выбранной мелодии, она вызывает <cite>buzzer_on()</cite> и <cite>buzzer_off()</cite> с различными задержками (<cite>usleep</cite>) для создания уникальных звуковых последовательностей.</p></li>
<li><p><strong>Обработка событий GUI</strong>:
* Когда вы выбираете радиокнопку, срабатывает функция <cite>on_melody_selected()</cite>, которая обновляет глобальную переменную <cite>selected_melody</cite>.
* Когда вы нажимаете кнопку «Проиграть», вызывается функция <cite>on_play_clicked()</cite>, которая, в свою очередь, запускает <cite>play_melody()</cite> с текущим значением <cite>selected_melody</cite>.</p></li>
<li><p><strong>Очистка ресурсов</strong>: При закрытии окна программы функция <cite>on_destroy()</cite> гарантирует, что зуммер выключен, а все ресурсы <cite>libgpiod</cite> (линия и чип GPIO) корректно освобождены. Это предотвращает утечки ресурсов и позволяет другим программам использовать эти GPIO-пины.</p></li>
</ol>
<p>—</p>
</section>
<section id="id3">
<h2>Схема подключения<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h2>
<p>Для работы программы необходимо правильно подключить активный зуммер к Raspberry Pi. Поскольку GPIO-пины Raspberry Pi не могут выдавать достаточный ток для прямого питания большинства зуммеров, мы используем NPN-транзистор в качестве переключателя.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>    Raspberry Pi
       +------+
GPIO17 --|      |
           |      |
           +------+
               |
               R1 (1 кОм)
               |
               V
           +---+---+  (База)
           |       |&lt;--- NPN Транзистор (например, BC547)
    (Коллектор) &gt;|       |
           |   +---+---+
           |           ^ (Эмиттер)
           |           |
           |           |
 +5V -----|           |-----&gt; GND (Земля Raspberry Pi)
           |           |
           |           V
           |       +-------+
           +------&gt;| ЗУММЕР |
                   +-------+
                     (-) (+)
</pre></div>
</div>
<p><strong>Важные моменты:</strong></p>
<ul class="simple">
<li><p><strong>R1 (1 кОм)</strong>: Токозадающий резистор, ограничивает ток на базу транзистора, защищая GPIO17.</p></li>
<li><p><strong>NPN-транзистор</strong>: Действует как управляемый переключатель. База подключается через резистор к GPIO17. Эмиттер подключается к <strong>GND</strong> Raspberry Pi. Коллектор подключается к отрицательному выводу зуммера.</p></li>
<li><p><strong>Активный зуммер</strong>: <strong>Обязательно соблюдайте полярность!</strong> Положительный вывод (+) зуммера подключается к пину <strong>+5V</strong> Raspberry Pi. Отрицательный вывод (-) зуммера подключается к коллектору NPN-транзистора.</p></li>
</ul>
<p>—</p>
</section>
<section id="id4">
<h2>Как скомпилировать программу<a class="headerlink" href="#id4" title="Permalink to this heading"></a></h2>
<p>Для компиляции программы вам потребуется установленный компилятор GCC, библиотеки <cite>gtk+-3.0</cite> и <cite>libgpiod</cite>.</p>
<ol class="arabic">
<li><p><strong>Убедитесь, что у вас установлены необходимые библиотеки:</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>libgtk-3-dev<span class="w"> </span>libgpiod-dev
</pre></div>
</div>
</li>
<li><p><strong>Сохраните исходный код</strong>: Сохраните ваш C-код в файл, например, <cite>buzzer_app.c</cite>.</p></li>
<li><p><strong>Скомпилируйте программу</strong> с помощью следующей команды:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gcc<span class="w"> </span>buzzer_app.c<span class="w"> </span>-o<span class="w"> </span>buzzer_app<span class="w"> </span><span class="k">$(</span>pkg-config<span class="w"> </span>--cflags<span class="w"> </span>--libs<span class="w"> </span>gtk+-3.0<span class="w"> </span>gpiod<span class="k">)</span>
</pre></div>
</div>
<p>Эта команда компилирует <cite>buzzer_app.c</cite>, создавая исполняемый файл с именем <cite>buzzer_app</cite>. Опции <cite>pkg-config</cite> автоматически добавляют необходимые флаги компилятора и библиотеки для GTK+ и <cite>libgpiod</cite>.</p>
</li>
</ol>
<p>—</p>
</section>
<section id="id5">
<h2>Как запустить программу<a class="headerlink" href="#id5" title="Permalink to this heading"></a></h2>
<p>После успешной компиляции вы можете запустить программу из терминала:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./buzzer_app
</pre></div>
</div>
<p>Если вы столкнулись с ошибками прав доступа, убедитесь, что ваш пользователь входит в группу <cite>gpio</cite> или что у вас настроены <cite>udev</cite>-правила для доступа к GPIO без <cite>sudo</cite>. В крайнем случае, для тестирования можно запустить с <cite>sudo</cite>, но это не рекомендуется для постоянного использования:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>./buzzer_app
</pre></div>
</div>
<p>—</p>
</section>
<section id="id6">
<h2>Что вы услышите?<a class="headerlink" href="#id6" title="Permalink to this heading"></a></h2>
<p>В зависимости от выбранной мелодии, зуммер воспроизведёт следующие звуковые паттерны:</p>
<ul class="simple">
<li><p><strong>Мелодия 1</strong>: Два коротких писка разной длины (один короче, один длиннее), разделённые небольшой паузой.</p></li>
<li><p><strong>Мелодия 2</strong>: Серия из четырёх коротких, равномерных писков с равными паузами между ними.</p></li>
<li><p><strong>Мелодия 3</strong>: Два длинных писка, разделённые короткой паузой.</p></li>
</ul>
<p>—</p>
</section>
<section id="id7">
<h2>Как создать ярлык для запуска (опционально)<a class="headerlink" href="#id7" title="Permalink to this heading"></a></h2>
<p>Чтобы сделать программу более удобной для запуска без терминала, вы можете создать файл <cite>.desktop</cite>.</p>
<ol class="arabic">
<li><p><strong>Создайте файл `.desktop`</strong>: Откройте текстовый редактор и создайте файл, например, <cite>/home/pi/.local/share/applications/buzzer_app.desktop</cite> (замените <cite>/home/pi</cite> на ваш домашний каталог, если он отличается).</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[Desktop Entry]</span>
<span class="na">Name</span><span class="o">=</span><span class="s">Buzzer Controller</span>
<span class="na">Comment</span><span class="o">=</span><span class="s">Control buzzer melodies on Raspberry Pi</span>
<span class="na">Exec</span><span class="o">=</span><span class="s">/path/to/your/buzzer_app</span>
<span class="na">Icon</span><span class="o">=</span><span class="s">/path/to/your/icon.png  (опционально, путь к иконке)</span>
<span class="na">Terminal</span><span class="o">=</span><span class="s">false</span>
<span class="na">Type</span><span class="o">=</span><span class="s">Application</span>
<span class="na">Categories</span><span class="o">=</span><span class="s">Utility</span><span class="c1">;Education;</span>
</pre></div>
</div>
<p><strong>Важно</strong>:
* Замените <cite>/path/to/your/buzzer_app</cite> на полный путь к вашему скомпилированному исполняемому файлу (например, <cite>/home/pi/buzzer_project/buzzer_app</cite>).
* Опционально укажите <cite>Icon=</cite> если у вас есть PNG-файл для иконки.
* <cite>Terminal=false</cite> означает, что программа запустится без открытия терминала.</p>
</li>
<li><p><strong>Сделайте файл исполняемым</strong>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>chmod<span class="w"> </span>+x<span class="w"> </span>/home/pi/.local/share/applications/buzzer_app.desktop
</pre></div>
</div>
</li>
</ol>
<p>Теперь ярлык «Buzzer Controller» должен появиться в меню приложений (например, в категории «Утилиты» или «Образование») или на рабочем столе, если вы его туда перетащите.</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Alex Malachevsky.</p>
  </div>

  Собрано при помощи <a href="https://www.sphinx-doc.org/">Sphinx</a> с использованием
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">темы,</a>
    предоставленной <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>